<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./CSS/main.css">
</head>
<body>
    <header id="inicio">
    </header>
    <main class="meio" style="background-image: url(./Fotos/undefined\ -\ Imgur.gif);">
        <div id="login">
            <h2 class="tituloL"">Cadastro de Conta</h2>
            <div class="masterL">
                <input type="text" id="nome" placeholder="Insira seu nome" class="inputX">
                <input type="text" id="email" placeholder="Insira seu e-mail" class="inputL2">
                <input type="text" id="senha" placeholder="Insira sua senha" class="inputR2">
                <button class="botaoL" onclick="cadastro()">Criar sua conta</button>
                <p class="info">Já está cadastrado? Faça login <a href="login.html">aqui.</a></p>
            </div>
        </div>
    </main>
    <footer id="fim">
        <p class="letras">Feito por</p>
        <p class="letras">Maurício Rosa de Moraes</p>
    </footer>
     <script>
        const params = new URLSearchParams(window.location.search);
        const id =params.get('id');

        if (id) {
            carregarUsuario();
        }

        async function carregarUsuario() {
            const res = await fetch(`http://localhost:1997/users/${id}`);
            const user = await res.json();

            document.getElementById('nome').value = user.nome;
            document.getElementById('email').value = user.email;
            document.querySelector('button').textContent = 'Atualizar';
        }
        async function cadastro() {
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;

            if (!nome || !email || (!id && !senha)) {
                alert('DEU ERRO, preencha todos os campos!');
                return;
            }

            const url = id
                ? `http://localhost:1997/users/${id}`
                : 'http://localhost:1997/users/register';

            const metodo = id ? 'PUT' : 'POST';

            let body = { nome, email };
            if (senha) body.senha = senha;

            const res = await fetch(url, {
                method: metodo,
                headers: { 'Content-type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (res.ok) {
                alert(id ? 'bla bla bla' : 'application/json');
                window.location.href = 'homepage.html';
            } else {
                const msg = await res.text();
                alert(msg);
            }
        }
    </script>
</body>
</html>